{"version":3,"file":"logbook_easa.min.js","sources":["../src/logbook_easa.js"],"sourcesContent":["/* eslint-disable no-undef */\n/* eslint-disable no-unused-vars */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module handles datatables for the logbook view.\n *\n * @module     local_booking/logbook_easa\n * @author     Mustafa Hajjar (mustafahajjar@gmail.com)\n * @copyright  BAVirtual.co.uk Â© 2023\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport 'jquery.dataTables';\n\n// Define column constants\nconst registerEventListeners = (root) => {\n    $(document).ready(function() {\n        var FLIGHTDATE = 0,\n            DEPICAO = 1,\n            DEPTIME = 2,\n            ARRICAO = 3,\n            ARRTIME = 4,\n            AIRCRAFT = 5,\n            AIRCRAFTREG = 6,\n            ENGINETYPE_SE = 7,\n            ENGINETYPE_ME = 8,\n            MULTIPILOT = 9,\n            TOTALTIME = 10,\n            P1NAME = 11,\n            LANDINGSDAY = 12,\n            LANDINGSNIGHT = 13,\n            NIGHTTIME = 14,\n            IFRTIME = 15,\n            PICTIME = 16,\n            COPILOTTIME = 17,\n            DUALTIME = 18,\n            INSTTIME = 19,\n            PICUSTIME = 20,\n            FSTD = 21,\n            REMARKS = 22;\n\n        var table = $('#logbook').DataTable({\n            \"order\": [[0, \"desc\"]],\n            \"ordering\": true,\n            \"lengthChange\": true,\n            \"lengthMenu\": [[10, 25, 50, 100, -1], [10, 25, 50, 100, \"All\"]],\n            \"autoWidth\": \"false\",\n            \"columnDefs\": [\n                {\"width\": \"50px\", \"targets\": FLIGHTDATE}, // Column: flightdate\n                {\"width\": \"50px\", \"targets\": DEPICAO}, // Column: depicao\n                {\"width\": \"45px\", \"targets\": DEPTIME}, // Column: deptime\n                {\"width\": \"50px\", \"targets\": ARRICAO}, // Column: arricao\n                {\"width\": \"45px\", \"targets\": ARRTIME}, // Column: arrtime\n                {\"width\": \"50px\", \"targets\": AIRCRAFT}, // Column: aircraft\n                {\"width\": \"50px\", \"targets\": AIRCRAFTREG}, // Column: aircraftreg\n                {\"width\": \"25px\", \"className\": \"dt-center\", \"targets\": ENGINETYPE_SE}, // Column: enginetype 'SE'\n                {\"width\": \"25px\", \"className\": \"dt-center\", \"targets\": ENGINETYPE_ME}, // Column: enginetype 'ME'\n                {\"width\": \"10px\", \"targets\": MULTIPILOT}, // Column: multipilot\n                {\"width\": \"10px\", \"targets\": TOTALTIME}, // Column: totaltime\n                {\"width\": \"130px\", \"targets\": P1NAME}, // Column: p1name\n                {\"width\": \"35px\", \"className\": \"dt-center\", \"targets\": LANDINGSDAY}, // Column: landingsday\n                {\"width\": \"35px\", \"className\": \"dt-center\", \"targets\": LANDINGSNIGHT}, // Column: landingsnight\n                {\"width\": \"35px\", \"targets\": NIGHTTIME}, // Column: nighttime\n                {\"width\": \"35px\", \"targets\": IFRTIME}, // Column: ifrtime\n                {\"width\": \"45px\", \"targets\": PICTIME}, // Column: pictime\n                {\"width\": \"45px\", \"targets\": COPILOTTIME}, // Column: copilottime\n                {\"width\": \"45px\", \"targets\": DUALTIME}, // Column: dualtime\n                {\"width\": \"50px\", \"targets\": INSTTIME}, // Column: instructortime\n                {\"width\": \"45px\", \"targets\": PICUSTIME}, // Column: picustime\n                {\"width\": \"15px\", \"targets\": FSTD}, // Column: fstd\n                {\"width\": \"160px\", \"targets\": REMARKS} // Column: remarks\n            ],\n            \"footerCallback\": function(row, data, start, end, display) {\n                var api = this.api();\n\n                // Convert to interger to find total\n                var intVal = function(i) {\n                    // Convert time format to number of minutes\n                    // eslint-disable-next-line no-nested-ternary\n                    return parseInt((typeof i === 'string') ? (parseInt((i.substring(0, i.indexOf(':'))) * 60) +\n                        parseInt(i.substring(i.indexOf(':') + 1, i.length))) : ((typeof i === 'number') ? i : 0));\n                };\n\n                // Calculate column Total of the complete result\n                var multipilotTotal = api.column(MULTIPILOT, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var grandTotal = api.column(TOTALTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var daylandingsTotal = api.column(LANDINGSDAY, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var nightlandingsTotal = api.column(LANDINGSNIGHT, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var nightimeTotal = api.column(NIGHTTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var ifrtimeTotal = api.column(IFRTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var pictimeTotal = api.column(PICTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var copilottimeTotal = api.column(COPILOTTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var dualtimeTotal = api.column(DUALTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var insttimeTotal = api.column(INSTTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var picustimeTotal = api.column(PICUSTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                // Convert number of minutes to time\n                var timeVal = function(i) {\n                    var time = i;\n                    if (i > 0) {\n                        var hrs = parseInt(i / 60);\n                        hrs = hrs < 10 ? ('00' + hrs).slice(-2) : hrs;\n                        var mins = '00' + (i % 60);\n                        time = hrs + ':' + mins.slice(-2);\n                    }\n                    return time;\n                };\n\n                // Update footer by showing the total with the reference of the column index\n                $(api.column(MULTIPILOT).footer()).html(multipilotTotal != 0 ? timeVal(multipilotTotal) : '');\n                $(api.column(TOTALTIME).footer()).html(timeVal(grandTotal));\n                $(api.column(LANDINGSDAY).footer()).html(daylandingsTotal);\n                $(api.column(LANDINGSNIGHT).footer()).html(nightlandingsTotal);\n                $(api.column(NIGHTTIME).footer()).html(nightimeTotal != 0 ? timeVal(nightimeTotal) : '');\n                $(api.column(IFRTIME).footer()).html(ifrtimeTotal != 0 ? timeVal(ifrtimeTotal) : '');\n                $(api.column(PICTIME).footer()).html(pictimeTotal != 0 ? timeVal(pictimeTotal) : '');\n                $(api.column(COPILOTTIME).footer()).html(copilottimeTotal != 0 ? timeVal(copilottimeTotal) : '');\n                $(api.column(DUALTIME).footer()).html(dualtimeTotal != 0 ? timeVal(dualtimeTotal) : '');\n                $(api.column(INSTTIME).footer()).html(insttimeTotal != 0 ? timeVal(insttimeTotal) : '');\n                $(api.column(PICUSTIME).footer()).html(picustimeTotal != 0 ? timeVal(picustimeTotal) : '');\n            },\n            dom: 'Blfrtip',\n            \"processing\": true\n        });\n\n        table.buttons(0, null).containers().appendTo('#logbook_filter');\n    });\n};\n\nexport const init = (root) => {\n    registerEventListeners(root);\n};\n"],"names":["_exports","init","root","$","document","ready","DataTable","order","ordering","lengthChange","lengthMenu","autoWidth","columnDefs","width","targets","className","footerCallback","row","data","start","end","display","api","this","intVal","i","parseInt","substring","indexOf","length","multipilotTotal","column","page","reduce","a","b","grandTotal","daylandingsTotal","nightlandingsTotal","nightimeTotal","ifrtimeTotal","pictimeTotal","copilottimeTotal","dualtimeTotal","insttimeTotal","picustimeTotal","timeVal","time","hrs","slice","footer","html","dom","processing","buttons","containers","appendTo"],"mappings":"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"}