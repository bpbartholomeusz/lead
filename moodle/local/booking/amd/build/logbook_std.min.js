/**
 * This module is responsible for registering listeners
 * for logbook std view events.
 *
 * @module     local_booking/logbook_std
 * @author     Mustafa Hajjar (mustafahajjar@gmail.com)
 * @copyright  BAVirtual.co.uk Â© 2023
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_booking/logbook_std",["jquery","core/pending","core/templates","core/notification","local_booking/booking_view_manager","local_booking/modal_actions","local_booking/events","local_booking/modal_logentry_form","local_booking/repository","local_booking/selectors"],(function($,Pending,Templates,Notification,ViewManager,ModalActions,BookingEvents,ModalLogentryEditForm,Repository,Selectors){const refreshNewLogentryContent=(root,logentry)=>{const courseId=$(Selectors.logbookwrapper).data("courseid"),userId=$(Selectors.logbookwrapper).data("userid");return M.util.js_pending(root.get("id")+"-"+courseId),Repository.getLogentryById(logentry.id,courseId,userId).then((response=>Templates.render("local_booking/logbook_std_logentry",response.logentry))).then((html=>{$("#logbook-summary").after(html),root.find(".logbook-shadow1:first").hide().slideDown(300)})).always((()=>{M.util.js_complete(root.get("id")+"-"+courseId)})).fail(Notification.exception)},refreshLogentryContent=(root,logentry)=>{let card=$("#cardid_"+logentry.id);showPlaceholder(card);const courseId=$(Selectors.logbookwrapper).data("courseid"),userId=$(Selectors.logbookwrapper).data("userid");return M.util.js_pending(root.get("id")+"-"+courseId),Repository.getLogentryById(logentry.id,courseId,userId).then((response=>Templates.render("local_booking/logbook_std_detail",response.logentry))).then(((html,js)=>Templates.replaceNode(card,html,js))).always((()=>(M.util.js_complete(root.get("id")+"-"+courseId),showContent(card)))).fail(Notification.exception)},registerLogentryAddForm=(root,e,contextId,courseId,userId)=>{const LogentryFormPromise=ModalLogentryEditForm.create(),target=e.target,pendingPromise=new Pending("local_booking/registerLogentryEditForm");ViewManager.renderLogentryEditForm(root,e,LogentryFormPromise,target,contextId,courseId,userId,0,!0,"local_booking/logbook_std").then(pendingPromise.resolve()).catch(window.console.error)},registerLogentryEditForm=(root,e,contextId,courseId,userId,logentryId)=>{const LogentryFormPromise=ModalLogentryEditForm.create(),target=e.target,pendingPromise=new Pending("local_booking/registerLogentryEditForm");ViewManager.renderLogentryEditForm(root,e,LogentryFormPromise,target,contextId,courseId,userId,logentryId,!1,"local_booking/logbook_std").then(pendingPromise.resolve()).catch(window.console.error)},showPlaceholder=function(card){card.find(Selectors.containers.loadingPlaceholder).removeClass("hidden"),card.find(Selectors.containers.content).addClass("hidden")},showContent=function(card){card.find(Selectors.containers.content).removeClass("hidden"),card.find(Selectors.containers.loadingPlaceholder).addClass("hidden")};return{init:function(rt){var root=$(rt);(root=>{$("body").on(BookingEvents.logentrycreated,(function(e,logentry){refreshNewLogentryContent(root,logentry)})),$("body").on(BookingEvents.logentryupdated,(function(e,logentry){refreshLogentryContent(root,logentry)})),$("body").on(BookingEvents.logentrydeleted,(function(e,logentryid){$("#logentry_"+logentryid).slideUp(300),e.stopImmediatePropagation()}));const contextId=$(Selectors.logbookwrapper).data("contextid"),courseId=$(Selectors.logbookwrapper).data("courseid"),userId=$(Selectors.logbookwrapper).data("userid");contextId&&(root.on("click",Selectors.actions.edit,(function(e){let logentryId=e.target.closest(Selectors.containers.summaryForm).dataset.logentryId;e.preventDefault(),e.stopPropagation(),registerLogentryEditForm(root,e,contextId,courseId,userId,logentryId),e.stopImmediatePropagation()})),root.on("click",Selectors.actions.add,(function(e){e.preventDefault(),e.stopPropagation(),registerLogentryAddForm(root,e,contextId,courseId,userId),e.stopImmediatePropagation()})))})(root),ModalActions.registerDelete(root),ViewManager.stopLoading(root)}}}));

//# sourceMappingURL=logbook_std.min.js.map