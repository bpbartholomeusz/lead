{"version":3,"file":"logbook.min.js","sources":["../src/logbook.js"],"sourcesContent":["/* eslint-disable no-unused-vars */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module handles datatables for the logbook view.\n *\n * @module     local_booking/logbook\n * @author     Mustafa Hajjar (mustafahajjar@gmail.com)\n * @copyright  BAVirtual.co.uk Â© 2021\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport 'local_booking/jquery.dataTables';\nimport 'local_booking/dataTables.bootstrap4';\nimport Notification from 'core/notification';\nimport * as Repository from 'local_booking/repository';\nimport * as ViewManager from 'local_booking/booking_view_manager';\nimport 'local_booking/datatables';\n\nexport const init = (root) => {\n    ViewManager.startLoading(root);\n    var courseId = $(root).data('courseid');\n    var userId = $(root).data('userid');\n    var logentries = [];\n\n    return Repository.getPilotLogbook(courseId, userId)\n    .then((entries) => {\n        entries.forEach(logentry => {\n            logentries.push([\n                logentry.flightdate,\n                logentry.depicao,\n                logentry.deptime,\n                logentry.arricao,\n                logentry.arrtime,\n                logentry.aircraft,\n                (logentry.aircraftreg !== undefined ? logentry.aircraftreg : ''),\n                (logentry.enginetype == 'SE') ? 'X' : '',\n                (logentry.enginetype == 'ME') ? 'X' : '',\n                (logentry.multipilot !== undefined ? logentry.multipilot : ''),\n                logentry.flighttime,\n                logentry.route,\n                logentry.p1name,\n                logentry.landingsday,\n                logentry.landingsnight,\n                logentry.nighttime,\n                logentry.ifrtime,\n                logentry.pictime,\n                logentry.copilottime,\n                logentry.dualtime,\n                logentry.instructortime,\n                (logentry.picustime !== undefined ? logentry.picustime : ''),\n                logentry.fstd,\n                logentry.remarks,\n            ]);\n        });\n\n        // Define column constants\n        const FLIGHTDATE = 0, DEPICAO = 1, DEPTIME = 2, ARRICAO = 3, ARRTIME = 4, AIRCRAFT = 5,\n              AIRCRAFTREG = 6, ENGINETYPE_SE = 7, ENGINETYPE_ME = 8, MULTIPILOT = 9, TOTALTIME = 10,\n              P1NAME = 11, ROUTE = 22, LANDINGSDAY = 12, LANDINGSNIGHT = 13, NIGHTTIME = 14, IFRTIME = 15,\n              PICTIME = 16, COPILOTTIME = 17, DUALTIME = 18, INSTTIME = 19, PICUSTIME = 20,\n              FSTD = 21, REMARKS = 22;\n\n        $('#logbook').DataTable({\n            data: logentries,\n            \"order\": [[0, \"desc\"]],\n            \"lengthMenu\": [[10, 25, 50, 100, -1], [10, 25, 50, 100, \"All\"]],\n            \"columnDefs\": [\n                {\"width\": \"80px\", \"targets\": FLIGHTDATE}, // Column: flightdate\n                {\"width\": \"50px\", \"targets\": DEPICAO}, // Column: depicao\n                {\"width\": \"45px\", \"targets\": DEPTIME}, // Column: deptime\n                {\"width\": \"50px\", \"targets\": ARRICAO}, // Column: arricao\n                {\"width\": \"45px\", \"targets\": ARRTIME}, // Column: arrtime\n                {\"width\": \"50px\", \"targets\": AIRCRAFT}, // Column: aircraft\n                {\"width\": \"50px\", \"targets\": AIRCRAFTREG}, // Column: aircraftreg\n                {\"width\": \"25px\", \"className\": \"dt-center\", \"targets\": ENGINETYPE_SE}, // Column: enginetype 'SE'\n                {\"width\": \"25px\", \"className\": \"dt-center\", \"targets\": ENGINETYPE_ME}, // Column: enginetype 'ME'\n                {\"width\": \"45px\", \"targets\": MULTIPILOT}, // Column: multipilot\n                {\"width\": \"45px\", \"targets\": TOTALTIME}, // Column: total flight time\n                {\"width\": \"160px\", \"targets\": P1NAME}, // Column: p1name\n                {\"width\": \"200px\", \"targets\": ROUTE}, // Column: route\n                {\"width\": \"35px\", \"className\": \"dt-center\", \"targets\": LANDINGSDAY}, // Column: landingsday\n                {\"width\": \"35px\", \"className\": \"dt-center\", \"targets\": LANDINGSNIGHT}, // Column: landingsnight\n                {\"width\": \"50px\", \"targets\": NIGHTTIME}, // Column: nighttime\n                {\"width\": \"45px\", \"targets\": IFRTIME}, // Column: ifrtime\n                {\"width\": \"45px\", \"targets\": PICTIME}, // Column: pictime\n                {\"width\": \"45px\", \"targets\": COPILOTTIME}, // Column: copilottime\n                {\"width\": \"45px\", \"targets\": DUALTIME}, // Column: dualtime\n                {\"width\": \"45px\", \"targets\": INSTTIME}, // Column: instructortime\n                {\"width\": \"45px\", \"targets\": PICUSTIME}, // Column: picustime\n                {\"width\": \"30px\", \"targets\": FSTD}, // Column: fstd\n                {\"width\": \"200px\", \"targets\": REMARKS} // Column: remarks\n            ],\n            \"footerCallback\": function(row, data, start, end, display) {\n                var api = this.api();\n\n                // Convert to interger to find total\n                var intVal = function(i) {\n                    // Convert time format to number of minutes\n                    // eslint-disable-next-line no-nested-ternary\n                    return parseInt((typeof i === 'string') ? (parseInt((i.substring(0, i.indexOf(':'))) * 60) +\n                        parseInt(i.substring(i.indexOf(':') + 1, i.length))) : ((typeof i === 'number') ? i : 0));\n                };\n\n                // Calculate column Total of the complete result\n                var multipilotTotal = api.column(MULTIPILOT, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var grandTotal = api.column(TOTALTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var daylandingsTotal = api.column(LANDINGSDAY, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var nightlandingsTotal = api.column(LANDINGSNIGHT, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var nightimeTotal = api.column(NIGHTTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var ifrtimeTotal = api.column(IFRTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var pictimeTotal = api.column(PICTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var copilottimeTotal = api.column(COPILOTTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var dualtimeTotal = api.column(DUALTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var insttimeTotal = api.column(INSTTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                var picustimeTotal = api.column(PICUSTIME, {page: 'current'}).data().reduce(function(a, b) {\n                        return intVal(a) + intVal(b);\n                    }, 0);\n\n                // Convert number of minutes to time\n                var timeVal = function(i) {\n                    var time = i;\n                    if (i > 0) {\n                        var hrs = parseInt(i / 60);\n                        hrs = hrs < 10 ? ('00' + hrs).substring(('00' + hrs).length, -2) : hrs;\n                        var mins = '00' + (i % 60);\n                        time = hrs + ':' + mins.substring(mins.length - 2);\n                    }\n                    return time;\n                };\n\n                // Update footer by showing the total with the reference of the column index\n                $(api.column(MULTIPILOT).footer()).html(multipilotTotal != 0 ? timeVal(multipilotTotal) : '');\n                $(api.column(TOTALTIME).footer()).html(timeVal(grandTotal));\n                $(api.column(LANDINGSDAY).footer()).html(daylandingsTotal != 0 ? daylandingsTotal : '');\n                $(api.column(LANDINGSNIGHT).footer()).html(nightlandingsTotal != 0 ? nightlandingsTotal : '');\n                $(api.column(NIGHTTIME).footer()).html(nightimeTotal != 0 ? timeVal(nightimeTotal) : '');\n                $(api.column(IFRTIME).footer()).html(ifrtimeTotal != 0 ? timeVal(ifrtimeTotal) : '');\n                $(api.column(PICTIME).footer()).html(pictimeTotal != 0 ? timeVal(pictimeTotal) : '');\n                $(api.column(COPILOTTIME).footer()).html(copilottimeTotal != 0 ? timeVal(copilottimeTotal) : '');\n                $(api.column(DUALTIME).footer()).html(dualtimeTotal != 0 ? timeVal(dualtimeTotal) : '');\n                $(api.column(INSTTIME).footer()).html(insttimeTotal != 0 ? timeVal(insttimeTotal) : '');\n                $(api.column(PICUSTIME).footer()).html(picustimeTotal != 0 ? timeVal(picustimeTotal) : '');\n            },\n            \"processing\": true\n        });\n\n        return;\n    })\n    .always(() => {\n        ViewManager.stopLoading(root);\n    })\n    .fail(Notification.exception);\n };"],"names":["_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_interopRequireWildcard","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_interopRequireDefault","_jquery","_notification","Repository","ViewManager","_exports","init","root","startLoading","courseId","$","data","userId","logentries","getPilotLogbook","then","entries","forEach","logentry","push","flightdate","depicao","deptime","arricao","arrtime","aircraft","undefined","aircraftreg","enginetype","multipilot","flighttime","route","p1name","landingsday","landingsnight","nighttime","ifrtime","pictime","copilottime","dualtime","instructortime","picustime","fstd","remarks","DataTable","order","lengthMenu","columnDefs","width","targets","className","footerCallback","row","start","end","display","api","this","intVal","i","parseInt","substring","indexOf","length","multipilotTotal","column","page","reduce","a","b","grandTotal","daylandingsTotal","nightlandingsTotal","nightimeTotal","ifrtimeTotal","pictimeTotal","copilottimeTotal","dualtimeTotal","insttimeTotal","picustimeTotal","timeVal","time","hrs","mins","footer","html","processing","always","stopLoading","fail","Notification","exception"],"mappings":"6UA8BkE,SAAAA,yBAAAC,aAAA,GAAA,mBAAAC,QAAA,OAAA,KAAA,IAAAC,kBAAAD,IAAAA,QAAAE,iBAAAF,IAAAA,eAAAF,yBAAA,SAAAC,aAAAA,OAAAA,YAAAG,iBAAAD,oBAAAF,YAAA,CAAA,SAAAI,wBAAAC,IAAAL,aAAAA,IAAAA,aAAAK,KAAAA,IAAAC,WAAAD,OAAAA,IAAAA,GAAAA,OAAAA,KAAAA,iBAAAA,KAAAE,mBAAAF,IAAAE,MAAAA,CAAAA,QAAAF,KAAAG,IAAAA,MAAAT,yBAAAC,aAAA,GAAAQ,OAAAA,MAAAC,IAAAJ,KAAA,OAAAG,MAAAE,IAAAL,KAAA,IAAAM,OAAAC,GAAAA,sBAAAC,OAAAC,gBAAAD,OAAAE,yBAAAC,IAAAA,IAAAA,OAAAX,IAAAW,eAAAA,KAAAH,OAAAI,UAAAC,eAAAC,KAAAd,IAAAW,KAAA,CAAA,IAAAI,KAAAR,sBAAAC,OAAAE,yBAAAV,IAAAW,KAAAI,KAAAA,OAAAA,KAAAV,KAAAU,KAAAC,KAAAR,OAAAC,eAAAH,OAAAK,IAAAI,MAAAT,OAAAK,KAAAX,IAAAW,IAAAL,QAAAA,OAAAJ,QAAAF,IAAAG,OAAAA,MAAAa,IAAAhB,IAAAM,QAAAA,MAAA,CAAA,SAAAW,uBAAAjB,KAAAA,OAAAA,KAAAA,IAAAC,WAAAD,IAAAE,CAAAA,QAAAF,IAAA;;;;;;;;kFALlEkB,QAAAD,uBAAAC,SAGAC,cAAAF,uBAAAE,eACAC,WAAArB,wBAAAqB,YACAC,YAAAtB,wBAAAsB,aAuKGC,SAAAC,KApKkBC,OACjBH,YAAYI,aAAaD,MACzB,IAAIE,UAAW,EAAAC,QAACzB,SAACsB,MAAMI,KAAK,YACxBC,QAAS,EAAAF,QAACzB,SAACsB,MAAMI,KAAK,UACtBE,WAAa,GAEjB,OAAOV,WAAWW,gBAAgBL,SAAUG,QAC3CG,MAAMC,UACHA,QAAQC,SAAQC,WACZL,WAAWM,KAAK,CACZD,SAASE,WACTF,SAASG,QACTH,SAASI,QACTJ,SAASK,QACTL,SAASM,QACTN,SAASO,cACiBC,IAAzBR,SAASS,YAA4BT,SAASS,YAAc,GACrC,MAAvBT,SAASU,WAAsB,IAAM,GACd,MAAvBV,SAASU,WAAsB,IAAM,QACbF,IAAxBR,SAASW,WAA2BX,SAASW,WAAa,GAC3DX,SAASY,WACTZ,SAASa,MACTb,SAASc,OACTd,SAASe,YACTf,SAASgB,cACThB,SAASiB,UACTjB,SAASkB,QACTlB,SAASmB,QACTnB,SAASoB,YACTpB,SAASqB,SACTrB,SAASsB,oBACed,IAAvBR,SAASuB,UAA0BvB,SAASuB,UAAY,GACzDvB,SAASwB,KACTxB,SAASyB,SACX,KAUN,EAAAjC,iBAAE,YAAYkC,UAAU,CACpBjC,KAAME,WACNgC,MAAS,CAAC,CAAC,EAAG,SACdC,WAAc,CAAC,CAAC,GAAI,GAAI,GAAI,KAAM,GAAI,CAAC,GAAI,GAAI,GAAI,IAAK,QACxDC,WAAc,CACV,CAACC,MAAS,OAAQC,QAXP,GAYX,CAACD,MAAS,OAAQC,QAZM,GAaxB,CAACD,MAAS,OAAQC,QAbmB,GAcrC,CAACD,MAAS,OAAQC,QAdgC,GAelD,CAACD,MAAS,OAAQC,QAf6C,GAgB/D,CAACD,MAAS,OAAQC,QAhB2D,GAiB7E,CAACD,MAAS,OAAQC,QAhBN,GAiBZ,CAACD,MAAS,OAAQE,UAAa,YAAaD,QAjBb,GAkB/B,CAACD,MAAS,OAAQE,UAAa,YAAaD,QAlBM,GAmBlD,CAACD,MAAS,OAAQC,QAnBgD,GAoBlE,CAACD,MAAS,OAAQC,QApB+D,IAqBjF,CAACD,MAAS,QAASC,QApBZ,IAqBP,CAACD,MAAS,QAASC,QArBA,IAsBnB,CAACD,MAAS,OAAQE,UAAa,YAAaD,QAtBP,IAuBrC,CAACD,MAAS,OAAQE,UAAa,YAAaD,QAvBa,IAwBzD,CAACD,MAAS,OAAQC,QAxBuD,IAyBzE,CAACD,MAAS,OAAQC,QAzBqE,IA0BvF,CAACD,MAAS,OAAQC,QAzBV,IA0BR,CAACD,MAAS,OAAQC,QA1BQ,IA2B1B,CAACD,MAAS,OAAQC,QA3BuB,IA4BzC,CAACD,MAAS,OAAQC,QA5BsC,IA6BxD,CAACD,MAAS,OAAQC,QA7BsD,IA8BxE,CAACD,MAAS,OAAQC,QA7Bb,IA8BL,CAACD,MAAS,QAASC,QA9BA,KAgCvBE,eAAkB,SAASC,IAAKzC,KAAM0C,MAAOC,IAAKC,SAC9C,IAAIC,IAAMC,KAAKD,MAGXE,OAAS,SAASC,GAGlB,OAAOC,SAAuB,iBAAND,EAAmBC,SAA4C,GAAlCD,EAAEE,UAAU,EAAGF,EAAEG,QAAQ,OAC1EF,SAASD,EAAEE,UAAUF,EAAEG,QAAQ,KAAO,EAAGH,EAAEI,SAA2B,iBAANJ,EAAkBA,EAAI,IAI1FK,gBAAkBR,IAAIS,OA/CwC,EA+CrB,CAACC,KAAM,YAAYvD,OAAOwD,QAAO,SAASC,EAAGC,GAClF,OAAOX,OAAOU,GAAKV,OAAOW,EAC7B,GAAE,GAEHC,WAAad,IAAIS,OAnD4D,GAmD1C,CAACC,KAAM,YAAYvD,OAAOwD,QAAO,SAASC,EAAGC,GAC5E,OAAOX,OAAOU,GAAKV,OAAOW,EAC7B,GAAE,GAEHE,iBAAmBf,IAAIS,OAtDU,GAsDU,CAACC,KAAM,YAAYvD,OAAOwD,QAAO,SAASC,EAAGC,GACpF,OAAOX,OAAOU,GAAKV,OAAOW,EAC7B,GAAE,GAEHG,mBAAqBhB,IAAIS,OA1D4B,GA0DN,CAACC,KAAM,YAAYvD,OAAOwD,QAAO,SAASC,EAAGC,GACxF,OAAOX,OAAOU,GAAKV,OAAOW,EAC7B,GAAE,GAEHI,cAAgBjB,IAAIS,OA9DiD,GA8D/B,CAACC,KAAM,YAAYvD,OAAOwD,QAAO,SAASC,EAAGC,GAC/E,OAAOX,OAAOU,GAAKV,OAAOW,EAC7B,GAAE,GAEHK,aAAelB,IAAIS,OAlEgE,GAkEhD,CAACC,KAAM,YAAYvD,OAAOwD,QAAO,SAASC,EAAGC,GAC5E,OAAOX,OAAOU,GAAKV,OAAOW,EAC7B,GAAE,GAEHM,aAAenB,IAAIS,OArEf,GAqE+B,CAACC,KAAM,YAAYvD,OAAOwD,QAAO,SAASC,EAAGC,GAC5E,OAAOX,OAAOU,GAAKV,OAAOW,EAC7B,GAAE,GAEHO,iBAAmBpB,IAAIS,OAzED,GAyEqB,CAACC,KAAM,YAAYvD,OAAOwD,QAAO,SAASC,EAAGC,GACpF,OAAOX,OAAOU,GAAKV,OAAOW,EAC7B,GAAE,GAEHQ,cAAgBrB,IAAIS,OA7EiB,GA6EA,CAACC,KAAM,YAAYvD,OAAOwD,QAAO,SAASC,EAAGC,GAC9E,OAAOX,OAAOU,GAAKV,OAAOW,EAC7B,GAAE,GAEHS,cAAgBtB,IAAIS,OAjFgC,GAiFf,CAACC,KAAM,YAAYvD,OAAOwD,QAAO,SAASC,EAAGC,GAC9E,OAAOX,OAAOU,GAAKV,OAAOW,EAC7B,GAAE,GAEHU,eAAiBvB,IAAIS,OArF+C,GAqF7B,CAACC,KAAM,YAAYvD,OAAOwD,QAAO,SAASC,EAAGC,GAChF,OAAOX,OAAOU,GAAKV,OAAOW,EAC7B,GAAE,GAGHW,QAAU,SAASrB,GACnB,IAAIsB,KAAOtB,EACX,GAAIA,EAAI,EAAG,CACP,IAAIuB,IAAMtB,SAASD,EAAI,IAEnBwB,KAAO,KAAQxB,EAAI,GACvBsB,MAFAC,IAAMA,IAAM,IAAM,KAAOA,KAAKrB,WAAW,KAAOqB,KAAKnB,QAAS,GAAKmB,KAEtD,IAAMC,KAAKtB,UAAUsB,KAAKpB,OAAS,EACpD,CACA,OAAOkB,OAIX,EAAAvE,QAAAA,SAAE8C,IAAIS,OAxG4D,GAwGzCmB,UAAUC,KAAwB,GAAnBrB,gBAAuBgB,QAAQhB,iBAAmB,KAC1F,EAAAtD,iBAAE8C,IAAIS,OAzG2E,IAyGzDmB,UAAUC,KAAKL,QAAQV,cAC/C,EAAA5D,QAAAA,SAAE8C,IAAIS,OAzG+B,IAyGXmB,UAAUC,KAAyB,GAApBd,iBAAwBA,iBAAmB,KACpF,EAAA7D,QAAAA,SAAE8C,IAAIS,OA1GmD,IA0G7BmB,UAAUC,KAA2B,GAAtBb,mBAA0BA,mBAAqB,KAC1F,EAAA9D,QAAAA,SAAE8C,IAAIS,OA3GmE,IA2GjDmB,UAAUC,KAAsB,GAAjBZ,cAAqBO,QAAQP,eAAiB,KACrF,EAAA/D,QAAAA,SAAE8C,IAAIS,OA5GiF,IA4GjEmB,UAAUC,KAAqB,GAAhBX,aAAoBM,QAAQN,cAAgB,KACjF,EAAAhE,QAAAA,SAAE8C,IAAIS,OA5GE,IA4GcmB,UAAUC,KAAqB,GAAhBV,aAAoBK,QAAQL,cAAgB,KACjF,EAAAjE,QAAAA,SAAE8C,IAAIS,OA7GoB,IA6GAmB,UAAUC,KAAyB,GAApBT,iBAAwBI,QAAQJ,kBAAoB,KAC7F,EAAAlE,QAAAA,SAAE8C,IAAIS,OA9GmC,IA8GlBmB,UAAUC,KAAsB,GAAjBR,cAAqBG,QAAQH,eAAiB,KACpF,EAAAnE,QAAAA,SAAE8C,IAAIS,OA/GkD,IA+GjCmB,UAAUC,KAAsB,GAAjBP,cAAqBE,QAAQF,eAAiB,KACpF,EAAApE,QAAAA,SAAE8C,IAAIS,OAhHkE,IAgHhDmB,UAAUC,KAAuB,GAAlBN,eAAsBC,QAAQD,gBAAkB,GAC1F,EACDO,YAAc,GAGlB,IAEHC,QAAO,KACJnF,YAAYoF,YAAYjF,KAAK,IAEhCkF,KAAKC,cAAYzG,QAAC0G,UAAU,CAC9B"}